- id: alarm-trigger-away
  alias: Set off alarm while armed away
  trigger:
  - entity_id: binary_sensor.ians_left_window_status
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.ians_entry_door_status
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.ians_right_window_status
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarm
    state: armed_away
  action:
  - service: alarm_control_panel.alarm_trigger
  hide_entity: true
  initial_state: true
- id: alarm-trigger-night
  alias: Set off alarm while armed night
  trigger:
  - entity_id: binary_sensor.ians_left_window_status
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.ians_right_window_status
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarm
    state: armed_night
  action:
  - service: alarm_control_panel.alarm_trigger
  hide_entity: true
  initial_state: true
- id: alarm-trigger-home
  alias: Set off alarm while armed home
  trigger:
  - entity_id: binary_sensor.ians_left_window_status
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.ians_right_window_status
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarm
    state: armed_home
  action:
  - service: alarm_control_panel.alarm_trigger
  hide_entity: true
  initial_state: true
- id: login-1
  alias: Send notification upon failed login attempt
  trigger:
  - platform: state
    entity_id: persistent_notification.httplogin
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.state != off }}'
  action:
  - service: notify.pushbullet_ian
    data_template:
      title: Failed Home Assistant login attempt!
      message: '{{ trigger.to_state.state }}'
      data:
        url: http://www.ip-tracker.org/locator/ip-lookup.php?ip={{ states.persistent_notification.httplogin.state.split
          ("from ") [1]}}
- id: reminder-garbage
  alias: Garbage and Recycling Reminder
  trigger:
  - platform: time
    at: 08:00:00
  condition:
  - condition: time
    weekday:
    - fri
  action:
  - data:
      data:
        push:
          badge: 1
      title: Garbage and Recycling Day!
      message: Remember to take out the cans
    service: notify.ios_ians_iphone
  hide_entity: true
  initial_state: true
- alias: NWS Weather Alert Pop Up Control
  id: nws-alert-1
  trigger:
    platform: state
    entity_id: sensor.nws_alerts
  condition:
  - condition: template
    value_template: '{{states.sensor.nws_alerts.state | int > 0}}'
  - condition: template
    value_template: '{{ trigger.to_state.state|float > trigger.from_state.state|float
      }}'
  action:
    service: script.nws_popup_on_wx_alert
    data_template:
      title: "{% if states.sensor.nws_alerts.attributes.title.split(' - ')[5] is defined\
        \ %}\n  \"{{ states.sensor.nws_alerts.attributes.title.split(' - ')[5] }}\"\
        \n{% elif states.sensor.nws_alerts.attributes.title.split(' - ')[4] is defined\
        \ %}\n  \"{{ states.sensor.nws_alerts.attributes.title.split(' - ')[4] }}\"\
        \n{% elif states.sensor.nws_alerts.attributes.title.split(' - ')[3] is defined\
        \ %}\n  \"{{ states.sensor.nws_alerts.attributes.title.split(' - ')[3] }}\"\
        \n{% elif states.sensor.nws_alerts.attributes.title.split(' - ')[2] is defined\
        \ %}\n  \"{{ states.sensor.nws_alerts.attributes.title.split(' - ')[2] }}\"\
        \n{% elif states.sensor.nws_alerts.attributes.title.split(' - ')[1] is defined\
        \ %}\n  \"{{ states.sensor.nws_alerts.attributes.title.split(' - ')[1] }}\"\
        \n{% else %}\n  \"{{ states.sensor.nws_alerts.attributes.title.split(' - ')[0]\
        \ }}\"\n{% endif %}\n"
      message: "{% if states.sensor.nws_alerts.attributes.display_desc.split('\\n\\\
        n-\\n\\n')[5] is defined %}\n  \"{{ states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[5] }}\"\n{% elif states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[4] is defined %}\n  \"{{ states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[4] }}\"\n{% elif states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[3] is defined %}\n  \"{{ states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[3] }}\"\n{% elif states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[2] is defined %}\n  \"{{ states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[2] }}\"\n{% elif states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[1] is defined %}\n  \"{{ states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[1] }}\"\n{% else %}\n  \"{{ states.sensor.nws_alerts.attributes.display_desc.split('\\\
        n\\n-\\n\\n')[0] }}\"\n{% endif %}\n"
- alias: NWS Notification Weather Alert
  id: nws-alert-2
  trigger:
    platform: state
    entity_id: sensor.nws_alerts
  condition:
  - condition: template
    value_template: '{{states.sensor.nws_alerts.state | int > 0}}'
  - condition: template
    value_template: '{{ trigger.to_state.state|float > trigger.from_state.state|float
      }}'
  action:
  - service: notify.ios_ians_iphone
    data_template:
      message: "{% if states.sensor.nws_alerts.attributes.title.split(' - ')[5] is\
        \ defined %}\n  \"NWS: {{ states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[5] }}\"\n{% elif states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[4] is defined %}\n  \"NWS: {{ states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[4] }}\"\n{% elif states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[3] is defined %}\n  \"NWS: {{ states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[3] }}\"\n{% elif states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[2] is defined %}\n  \"NWS: {{ states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[2] }}\"\n{% elif states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[1] is defined %}\n  \"NWS: {{ states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[1] }}\"\n{% else %}\n  \"NWS: {{ states.sensor.nws_alerts.attributes.title.split('\
        \ - ')[0] }}\"\n{% endif %}\n"
- alias: NWS Announce Weather Alert
  id: nws-alert-3
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.nws_alerts
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: '{{states.sensor.nws_alerts.state | int > 0}}'
    - condition: template
      value_template: '{{ trigger.to_state.state|float > trigger.from_state.state|float
        }}'
    - condition: template
      value_template: '{{ ((''Severe'' in states.sensor.nws_alerts.attributes.title)
        or (''Tornado'' in states.sensor.nws_alerts.attributes.title)) and ''Warning''
        in states.sensor.nws_alerts.attributes.title }}'
  action:
  - service: tts.google_say
    data_template:
      entity_id: all
      message: "{% if states.sensor.nws_alerts.attributes.spoken_desc.split('\\n\\\
        n-\\n\\n')[5] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[5] }}.\n{% elif states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[4] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[4] }}\n{% elif states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[3] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[3] }}\n{% elif states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[2] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[2] }}\n{% elif states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[1] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[1] }}\n{% else %}\n  Attention!,,,Attention!,,,The National\
        \ Weather Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[0] }}\n{% endif %}\n"
  - delay: 00:00:15
  - service: tt.google_say
    data_template:
      entity_id: all
      message: "{% if states.sensor.nws_alerts.attributes.spoken_desc.split('\\n\\\
        n-\\n\\n')[5] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[5] }}.\n{% elif states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[4] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[4] }}\n{% elif states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[3] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[3] }}\n{% elif states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[2] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[2] }}\n{% elif states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[1] is defined %}\n  Attention!,,,Attention!,,,The National Weather\
        \ Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[1] }}\n{% else %}\n  Attention!,,,Attention!,,,The National\
        \ Weather Service Has issued a {{ states.sensor.nws_alerts.attributes.spoken_desc.split('\\\
        n\\n-\\n\\n')[0] }}\n{% endif %}\n"
